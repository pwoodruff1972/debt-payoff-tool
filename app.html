<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Payoff Tool</title>
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #f4f7f6; margin: 0; color: #333; }
        .container { max-width: 800px; margin: auto; padding: 1em 2em 2em 2em; }
        .header { background-color: #fff; padding: 1rem 2rem; border-bottom: 1px solid #e9ecef; margin-bottom: 1em; }
        .header a { text-decoration: none; font-weight: 600; color: #007bff; }
        h1, h2, h3 { color: #111; }
        h2 { border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 2em; }
        input[type="text"], input[type="number"] { width: 95%; padding: 10px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 16px; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        ul { list-style-type: none; padding: 0; }
        li { background: #e9ecef; padding: 15px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background-color: #dc3545; padding: 5px 10px; font-size: 12px; }
        .delete-btn:hover { background-color: #c82333; }
        .card { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 2em; border: 1px solid #dee2e6; }
        .card h3 { margin-top: 0; }
        .strategy-selector label { margin-right: 20px; cursor: pointer; font-weight: 500; }
        .strategy-description { font-size: 14px; color: #666; padding-left: 22px; margin-bottom: 10px; margin-top: 2px; }
        #results { margin-top: 2em; background-color: #e6f7ff; border: 1px solid #91d5ff; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 1em; }
        th, td { text-align: left; padding: 12px 8px; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        #min-payment-guidance { display: block; margin-top: -5px; margin-bottom: 15px; font-size: 14px; color: #555; }
        #plan-tbody tr { cursor: pointer; }
        #plan-tbody tr:hover { background-color: #d1ecf1; }
        #plan-tbody tr.paid-row { background-color: #d4edda; color: #555; text-decoration: line-through; }
        #plan-tbody tr.paid-row:hover { background-color: #c3e6cb; }
        #month-details { margin-top: 1.5em; padding: 15px; background-color: #fff; border: 1px solid #ccc; border-radius: 8px; }
        #month-details ul { padding-left: 20px; list-style-type: disc; }
        #month-details li { background: none; padding: 4px 0; margin-bottom: 0; display: list-item; }
        .data-management button { background-color: #6c757d; margin-right: 10px; }
        .data-management button:hover { background-color: #5a6268; }
        .toggle-paid-btn { background-color: #28a745; font-size: 12px; padding: 4px 8px; cursor: pointer; }
        .toggle-paid-btn.unmark { background-color: #ffc107; color: #333; }
    </style>
</head>
<body>

    <header class="header">
        <a href="index.html">&larr; Back to Homepage</a>
    </header>

    <div class="container">
        <h1>Debt Payoff Tool</h1>
        
        <h2>1. Add Your Debts</h2>
        <form id="debt-form" class="card">
            <input type="text" id="debt-name" placeholder="Debt Name (e.g., Visa)" required>
            <input type="number" id="debt-balance" placeholder="Current Balance ($)" required step="0.01">
            <input type="number" id="debt-apr" placeholder="Interest Rate (APR %)" required step="0.01">
            <input type="number" id="debt-min-payment" placeholder="Minimum Monthly Payment ($)" required step="0.01">
            <button type="submit">Add Debt</button>
        </form>

        <div class="data-management card">
            <h3>Data Management</h3>
            <p style="font-size: 14px; color: #555; margin-top: 0;">Save your debt list to a file as a backup, or load a previous backup from a file.</p>
            <button id="export-btn">Export to File</button>
            <button id="import-btn">Import from File</button>
            <input type="file" id="import-file" accept=".json" style="display: none;">
        </div>

        <h2>2. Your Debts List</h2>
        <ul id="debt-list"></ul>
        
        <h2>3. Create a Payoff Plan</h2>
        <div class="strategy-selector card">
            <h3>Choose Strategy</h3>
            <div>
                <label><input type="radio" name="strategy" value="snowball" checked> Debt Snowball</label>
                <div class="strategy-description">
                    Focuses on paying off the smallest debts first to build momentum and score quick wins.
                </div>
            </div>
            <div>
                <label><input type="radio" name="strategy" value="avalanche"> Debt Avalanche</label>
                <div class="strategy-description">
                    Focuses on paying off the highest interest rate debts first to save the most money over time.
                </div>
            </div>
        </div>

        <div class="calculator card">
            <h3>Set Your Budget</h3>
            <label for="total-payment">Total Monthly Payment ($)</label>
            <input type="number" id="total-payment" placeholder="e.g., 1500">
            <small id="min-payment-guidance"></small>
            <button id="calculate-btn">Calculate Plan</button>
        </div>

        <div id="results" style="display: none;">
            <h3>Your Payoff Plan <small>(Click a row for details)</small></h3>
            <p id="results-summary"></p>
            <table>
                <thead>
                    <tr><th>Month</th><th>Total Payment</th><th>Interest Paid</th><th>Remaining Balance</th><th>Status</th></tr>
                </thead>
                <tbody id="plan-tbody"></tbody>
            </table>
            <div id="month-details" style="display: none;"></div>
        </div>
    </div>

    <script>
        // --- ELEMENT REFERENCES ---
        const debtForm = document.getElementById('debt-form');
        const debtList = document.getElementById('debt-list');
        const strategyRadios = document.querySelectorAll('input[name="strategy"]');
        const totalPaymentInput = document.getElementById('total-payment');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultsDiv = document.getElementById('results');
        const resultsSummary = document.getElementById('results-summary');
        const planTbody = document.getElementById('plan-tbody');
        const minPaymentGuidance = document.getElementById('min-payment-guidance');
        const monthDetailsDiv = document.getElementById('month-details');
        const exportBtn = document.getElementById('export-btn');
        const importBtn = document.getElementById('import-btn');
        const importFileInput = document.getElementById('import-file');

        let debts = JSON.parse(localStorage.getItem('debts')) || [];
        let fullPlanDetails = [];
        let paidMonths = JSON.parse(localStorage.getItem('paidMonths')) || [];

        // --- EVENT LISTENERS ---
        debtForm.addEventListener('submit', addDebt);
        debtList.addEventListener('click', handleListClick);
        strategyRadios.forEach(radio => renderDebts());
        calculateBtn.addEventListener('click', calculatePlan);
        planTbody.addEventListener('click', handlePlanClick);
        exportBtn.addEventListener('click', exportData);
        importBtn.addEventListener('click', () => importFileInput.click());
        importFileInput.addEventListener('change', importData);

        // --- DATA FUNCTIONS ---
        function exportData() {
            if (debts.length === 0) { alert("There is no data to export."); return; }
            const dataToExport = {
                debts: debts,
                paidMonths: paidMonths,
                budget: totalPaymentInput.value
            };
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `my-debt-plan-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) { return; }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData.debts)) {
                        debts = importedData.debts;
                        paidMonths = importedData.paidMonths || [];
                        localStorage.setItem('paidMonths', JSON.stringify(paidMonths));
                        totalPaymentInput.value = importedData.budget || '';
                        saveAndRender();
                        alert("Data imported successfully! Click 'Calculate Plan' to see your new schedule.");
                    } else { throw new Error("Invalid file format."); }
                } catch (error) { alert("Error reading file. Please make sure it is a valid JSON file exported from this tool."); }
            };
            reader.onerror = function() { alert("Failed to read the file."); };
            reader.readAsText(file);
            importFileInput.value = '';
        }

        function addDebt(event) {
            event.preventDefault();
            const name = document.getElementById('debt-name').value;
            const balance = parseFloat(document.getElementById('debt-balance').value);
            const apr = parseFloat(document.getElementById('debt-apr').value);
            const minPayment = parseFloat(document.getElementById('debt-min-payment').value);
            if (!name || isNaN(balance) || isNaN(apr) || isNaN(minPayment) || balance <= 0 || apr < 0 || minPayment <= 0) { alert("Please enter valid positive numbers for all fields."); return; }
            if (debts.some(debt => debt.name.trim().toLowerCase() === name.trim().toLowerCase())) {
                alert("A debt with this name already exists. Please use a unique name.");
                return;
            }
            const newDebt = { id: Date.now(), name, balance, apr, minPayment };
            debts.push(newDebt);
            resetPlanAndProgress();
            saveAndRender();
            debtForm.reset();
        }

        function handleListClick(event) {
            if (event.target.classList.contains('delete-btn')) {
                const idToDelete = parseInt(event.target.dataset.id);
                debts = debts.filter(debt => debt.id !== idToDelete);
                resetPlanAndProgress();
                saveAndRender();
            }
        }
        
        function resetPlanAndProgress() {
            paidMonths = [];
            localStorage.removeItem('paidMonths');
            resultsDiv.style.display = 'none';
        }

        // --- CALCULATION ENGINE ---
        function calculatePlan() {
            const totalMonthlyPayment = parseFloat(totalPaymentInput.value);
            const totalMinimums = debts.reduce((sum, debt) => sum + debt.minPayment, 0);
            if (debts.length === 0) { alert("Please add at least one debt."); return; }
            if (isNaN(totalMonthlyPayment) || totalMonthlyPayment <= 0) { alert("Please enter a valid total monthly payment."); return; }
            if (totalMonthlyPayment < totalMinimums) { alert(`Your total monthly payment must be at least $${totalMinimums.toFixed(2)} to cover your minimums.`); return; }
            
            localStorage.setItem('monthlyBudget', totalMonthlyPayment);

            const selectedStrategy = document.querySelector('input[name="strategy"]:checked').value;
            let simulationDebts = JSON.parse(JSON.stringify(debts));
            
            let months = 0;
            let totalInterestPaid = 0;
            fullPlanDetails = [];

            while (simulationDebts.some(d => d.balance > 0)) {
                months++;
                if (months > 1200) { console.error("Calculation took too long."); break; }
                
                let interestForMonth = 0;
                
                for (const debt of simulationDebts) {
                    if (debt.balance > 0) {
                        const monthlyInterest = debt.balance * (debt.apr / 100 / 12);
                        interestForMonth += monthlyInterest;
                        debt.balance += monthlyInterest;
                    }
                }
                totalInterestPaid += interestForMonth;

                let paymentsThisMonth = {};
                for(const debt of simulationDebts) { paymentsThisMonth[debt.id] = 0; }
                
                let paymentBudget = totalMonthlyPayment;
                let minimumsDueThisMonth = 0;
                for (const debt of simulationDebts) {
                    if (debt.balance > 0) {
                        const minPayment = Math.min(debt.balance, debt.minPayment);
                        paymentsThisMonth[debt.id] = minPayment;
                        minimumsDueThisMonth += minPayment;
                    }
                }
                
                let extraPaymentPool = totalMonthlyPayment - minimumsDueThisMonth;

                const paymentOrder = [...simulationDebts].sort((a, b) => {
                    if (a.balance <= 0) return 1; if (b.balance <= 0) return -1;
                    const aBalanceOwed = a.balance - paymentsThisMonth[a.id];
                    const bBalanceOwed = b.balance - paymentsThisMonth[b.id];
                    if (selectedStrategy === 'snowball') {
                        if (aBalanceOwed === bBalanceOwed) return b.apr - a.apr;
                        return aBalanceOwed - bBalanceOwed;
                    } else {
                        if (b.apr === a.apr) return aBalanceOwed - bBalanceOwed;
                        return b.apr - a.apr;
                    }
                });

                for (const debt of paymentOrder) {
                    if (extraPaymentPool > 0 && debt.balance > 0) {
                        const remainingOwed = debt.balance - paymentsThisMonth[debt.id];
                        const extraPayment = Math.min(remainingOwed, extraPaymentPool);
                        paymentsThisMonth[debt.id] += extraPayment;
                        extraPaymentPool -= extraPayment;
                    }
                }
                
                const monthBreakdown = { month: months, payments: [], totalInterest: interestForMonth };
                for (const debt of simulationDebts) {
                    const paymentApplied = paymentsThisMonth[debt.id] || 0;
                    debt.balance -= paymentApplied;
                    monthBreakdown.payments.push({
                        name: debt.name,
                        paymentApplied: paymentApplied,
                        newBalance: debt.balance < 0.005 ? 0 : debt.balance
                    });
                }
                
                monthBreakdown.remainingBalance = simulationDebts.reduce((sum, d) => sum + d.balance, 0);
                fullPlanDetails.push(monthBreakdown);
            }
            displayResults(months, totalInterestPaid);
        }
        
        // --- UI & RENDER FUNCTIONS ---
        function displayResults(months, totalInterestPaid) {
            resultsDiv.style.display = 'block';
            monthDetailsDiv.style.display = 'none';
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;
            resultsSummary.textContent = `You will be debt-free in ${years} years and ${remainingMonths} months! Total interest paid: $${totalInterestPaid.toFixed(2)}.`;
            planTbody.innerHTML = '';
            
            fullPlanDetails.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.dataset.index = index;
                const isPaid = paidMonths.includes(row.month);
                if(isPaid) tr.classList.add('paid-row');

                const actualPaymentThisMonth = row.payments.reduce((sum, p) => sum + p.paymentApplied, 0);
                const buttonText = isPaid ? 'Unmark' : 'Mark Paid';
                const buttonClass = isPaid ? 'toggle-paid-btn unmark' : 'toggle-paid-btn';

                tr.innerHTML = `
                    <td>${row.month}</td>
                    <td>$${actualPaymentThisMonth.toFixed(2)}</td>
                    <td>$${row.totalInterest.toFixed(2)}</td>
                    <td>$${row.remainingBalance.toFixed(2)}</td>
                    <td><button class="${buttonClass}" data-month="${row.month}">${buttonText}</button></td>
                `;
                planTbody.appendChild(tr);
            });
        }

        function handlePlanClick(event) {
            if (event.target.classList.contains('toggle-paid-btn')) {
                event.stopPropagation(); // Prevent row click from firing
                const month = parseInt(event.target.dataset.month);
                toggleMonthPaid(month);
                return;
            }
            const row = event.target.closest('tr');
            if (!row) return;
            const monthIndex = parseInt(row.dataset.index);
            const monthData = fullPlanDetails[monthIndex];
            displayMonthDetails(monthData);
        }

        function toggleMonthPaid(month) {
            const index = paidMonths.indexOf(month);
            if (index > -1) {
                paidMonths.splice(index, 1);
            } else {
                paidMonths.push(month);
            }
            localStorage.setItem('paidMonths', JSON.stringify(paidMonths));
            
            const totalInterest = fullPlanDetails.reduce((sum, row) => sum + row.totalInterest, 0);
            displayResults(fullPlanDetails.length, totalInterest);
        }

        function displayMonthDetails(monthData) {
            monthDetailsDiv.style.display = 'block';
            let detailsHtml = `<h4>Details for Month ${monthData.month}</h4><ul>`;
            monthData.payments.forEach(p => {
                if (p.paymentApplied > 0.005) {
                    detailsHtml += `<li><strong>${p.name}:</strong> Pay $${p.paymentApplied.toFixed(2)} (New Balance: $${p.newBalance.toFixed(2)})</li>`;
                }
            });
            detailsHtml += `</ul>`;
            monthDetailsDiv.innerHTML = detailsHtml;
            monthDetailsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function saveAndRender() {
            saveDebts();
            renderDebts();
            updateGuidance();
            initializeState();
        }
        
        function renderDebts() {
            debtList.innerHTML = '';
            debts.forEach(debt => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<div><strong>${debt.name}</strong><br><small>$${debt.balance.toFixed(2)} @ ${debt.apr}% APR (Min: $${debt.minPayment.toFixed(2)})</small></div><button class="delete-btn" data-id="${debt.id}">Delete</button>`;
                debtList.appendChild(listItem);
            });
        }

        function saveDebts() {
            localStorage.setItem('debts', JSON.stringify(debts));
        }
        
        function updateGuidance() {
            const totalMinimums = debts.reduce((sum, debt) => sum + debt.minPayment, 0);
            if (totalMinimums > 0) {
                minPaymentGuidance.textContent = `Your total minimum payment is $${totalMinimums.toFixed(2)}. Pay more to get out of debt faster!`;
            } else {
                minPaymentGuidance.textContent = 'Enter your debts to see your minimum monthly payment.';
            }
        }

        function initializeState() {
            const savedBudget = localStorage.getItem('monthlyBudget');
            if (savedBudget) {
                totalPaymentInput.value = savedBudget;
                if (debts.length > 0) {
                    calculatePlan();
                }
            }
        }

        // --- INITIALIZATION ---
        saveAndRender();
    </script>
</body>
</html>

